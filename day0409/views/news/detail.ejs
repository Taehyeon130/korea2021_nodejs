<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">

<style>
body {font-family: Arial, Helvetica, sans-serif;}
* {box-sizing: border-box;}

input[type=text], textarea{
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}

textarea{
  height:200px;
}

input[type=button] {
  background-color: #4CAF50;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=button]:hover {
  background-color: #45a049;
}

.container {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}

.comment-list div{
  display: inline-block; 
  /* 블락속성(크기지정)유지하되 인라인이어서 공존가능 */
  border: 1px solid green;
}


</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
<!-- 제이쿼리 사용하기 위함 -->
<script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
<script>
  /*jquery의 문법형식 (누구를).어떻게 
    누구를 자리에 올수 있는 요소? - CSS의 selector가 올수 있다
    //  온로드 윈도우 리스너랑 똑같아 줄인거야
  */

  $(function(){ //onLoad 되면...
    // 편집기 입히기
    CKEDITOR.replace( 'content' );
    $($("input[type='button']")[0]).click(function(){ //등록
      edit();
    });
    $($("input[type='button']")[1]).click(function(){ //목록
      getList();
    });
  });

  function edit(){ //등록
    // form 태그로 영역을 설정
    // attr은 속성을 정하는거
    $("form").attr("action","/news/edit"); //url정함 단, 서버랑 짝을 맞추자
    $("form").attr("method","post");
    $("form").submit(); //전송 행위 발생
  }

  function getList(){//목록
    location.href="/news/list";
  }

  // 댓글 등록 요청
  function addComment(){
    // $("#comment-form").attr({
    //   method:"post",
    //   action:"/comments/regist"
    // });
    // $("#comment-form").submit();//전송
    
    // 화면의 일부만 변경하기 위해(부분변경), 백그라운드에서 요청을 시도
    var xhttp = new XMLHttpRequest(); //비동기 객체 생성

      // 이벤트 처리
      xhttp.onreadystatechange=function(){
        if(this.readyState==4 && this.status==200){
          // 서버에서 성공된 응답 데이터가 온 시점
          alert("서버로부터 받은 결과는 "+this.responseText);
        }
      }
    xhttp.open("POST", "/comments/regist", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    var msg = $("input[name='mag']").val();
    var author = $("input[name='author']").val();
    xhttp.send("news_id=<%=news[0]%>&msg="+msg+"&author="+author);

  }
</script>
</head>
<body>

<h3>Contact Form</h3>

<div class="container">

  <form id="detail-form">
    <input type="text" name="title" value="<%=news[1]%>">
    <input type="text" name="writer" value="<%=news[2]%>">
    <textarea name="content" ><%=news[3]%></textarea>
    
    <p></p>
    <input type="button" value="등록" >
    <input type="button" value="목록" >
    <!-- 문서내의 같은 애들은 배열로 생각해서 submit은 0번째 -->
    <p></p>
  </form>

  <form id="comment-form">
    <!-- 아래의 hidden의 용도? 어떤 뉴스기사에 대한 댓글인지 결정 지음-->
    <input type="hidden"  name="news_id" value="<%=news[0]%>">

    <input type="text"  name="msg" placeholder="댓글 내용" style="width: 70%">
    <input type="text" name = "author" placeholder="작성자" style="width: 15%">
    <input type="button" value="댓글 등록"  style="width: 10%" onclick="addComment()">
  </form>

  <%for(var i=0;i<commentsList.length;i++){%>
    <%var comments=commentsList[i]; //댓글 한건 꺼내기%>
  <div class="comment-list">
    <div style="width: 70%;"><%=comments[2]%></div>
    <div style="width: 15%;"><%=comments[3]%></div>
    <%
    var d = new Date(comments[4]);
    var yy = d.getFullYear();
    var mm=lib.getZeroString(d.getMon th()+1);
    var dd = lib.getZeroString(d.getDate());
    %>
    <div style="width: 10%;"><%=yy%>-<%=mm%>-<%=dd%></div>
  </div>
<%}%>
</div>

</body>
</html>